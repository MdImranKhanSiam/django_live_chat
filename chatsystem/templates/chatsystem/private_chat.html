{% extends "chatsystem/master.html" %}

{% block content %}
<h3>
    Private Chat between You({{ request.user.username }}) & {{ other_user.username }}
</h3>

<div id="chat-box">
    {% for message in all_messages %}
        <p>
            {{ message.sender.username }}: {{ message.message }}
        </p>
    {% endfor %}
</div>

<input type="text" id="message-input">
<button onclick="sendMessage()">
    Send
</button>

<script>
    const userId = "{{ other_user.id }}";

    // wss is for production, and instead of window.location it should be domain
    let url = `ws://${window.location.host}/ws/privatechat/${userId}/`;
    const websocket = new WebSocket(url);
    
    websocket.onmessage = function(e) {
        const data = JSON.parse(e.data);

        if(data.type === 'private-chat'){
            document.getElementById('chat-box').innerHTML += 
            `
            <p>
                ${data.sender}: ${data.live_message}
            </p>
            `;
        }
    }

    function sendMessage() {
        const user_input = document.getElementById('message-input');

        websocket.send(
            JSON.stringify(
                {
                    'typed_message' : user_input.value
                }
            )
        );

        user_input.value = '';
    }

</script>

{% endblock %}

